<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Client-Side Solution For Downloading Highcharts Charts as Images &mdash; Will Koehler</title>
  <!--[if lt IE 9]><script src='https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js'></script><![endif]-->
  
  <link rel="stylesheet" type="text/css" href="/assets/app-f8721d1cfe9253c756859b605a562e1e1ab9f005597f2d25c73e14dcd49fad73.css" integrity="sha256-+HIdHP6SU8dWhZtgWlYuHhq58AVZfy0lxz4U3NSfrXM=" crossorigin="anonymous">
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script src="/assets/app-7e9344783dc057ae0ff8f92a6d0ba41337ab1d641808beb16dd7a342878e8f61.js" type="text/javascript" integrity="sha256-fpNEeD3AV64P+PkqbQukEzerHWQYCL6xbdejQoeOj2E=" crossorigin="anonymous"></script>


<script>window.twttr = (function(d, s, id) {
   var js, fjs = d.getElementsByTagName(s)[0],
     t = window.twttr || {};
   if (d.getElementById(id)) return t;
   js = d.createElement(s);
   js.id = id;
   js.src = "https://platform.twitter.com/widgets.js";
   fjs.parentNode.insertBefore(js, fjs);
   t._e = [];
   t.ready = function(f) {
     t._e.push(f);
   };
   return t;
 }(document, "script", "twitter-wjs"));</script>



<script>(function(d, s, id) {
   var js, fjs = d.getElementsByTagName(s)[0];
   if (d.getElementById(id)) return;
   js = d.createElement(s); js.id = id;
   js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
   js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1';
   fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script>




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54124306-1', 'auto');
  ga('send', 'pageview');
</script>



  <link rel="shortcut icon" href="/favicon.ico?v2" type="image/x-icon" />
  <link rel="alternate" type="application/atom+xml" title="Will Koehler" href="/atom.xml" />
  <meta name="title" content="Client-Side Solution For Downloading Highcharts Charts as Images ">
  <link rel="canonical" href="http://willkoehler.net/2014/11/07/client-side-solution-for-downloading-highcharts-charts-as-images.html">
  <meta property="og:title" content="Client-Side Solution For Downloading Highcharts Charts as Images"/>
  <meta property="og:url" content="http://willkoehler.net/2014/11/07/client-side-solution-for-downloading-highcharts-charts-as-images.html"/>
  <meta property="og:image" content="http://willkoehler.net/images/brynhild-road-in-clintonville.jpg"/>
  
  <meta property="og:description" content="I wanted a straightforward, client-side solution for downloading the SVG charts generated by Highcharts as images. It can be done, but relies on a set of web technologies that are still evolving."/>
  <meta name="description" content="I wanted a straightforward, client-side solution for downloading the SVG charts generated by Highcharts as images. It can be done, but relies on a set of web technologies that are still evolving."/>
  
  <meta property="og:site_name" content="Will Koehler">
</head>
<body>

  <header class="site-header">
    <nav>
      <a class="brand" href="/">
        <img src="/images/logo.png" alt="Inc">
      </a>
      <a href="/">Blog</a>
      <a href="/about.html">About</a>
      <a href="/resume.html">Resume</a>
    </nav>
  </header>

  
<div class="article-cover" style="background-image:url(/images/brynhild-road-in-clintonville.jpg)"></div>


<div class='cover-caption'><a href='/about.html#pictures'>Brynhild Road in Clintonville. Photo: Will Koehler</a></div>


<article >

  <div class="container">
    <header>
      <div class="meta">
        By <address><a rel="author" href="" title="Will Koehler" target="_blank">Will Koehler</a></address> &mdash;
        <time pubdate datetime="2014-07-November" title="Nov 07, 2014">Nov 07, 2014</time> &mdash;
        
12 min read

      </div>
      <h1 class="title">Client-Side Solution For Downloading Highcharts Charts as Images</h1>
      <h2 class="subtitle">It even works in IE</h2>
    </header>

    <section>
      <p><a href="http://www.highcharts.com">Highcharts</a> is an excellent web-based charting package. But, because it’s a
client-side solution, downloading charts as images is tricky. The default solution is to use
Highcarts’ <a href="http://www.highcharts.com/docs/export-module/export-module-overview">export module</a>,
which posts the chart’s SVG code to Highcharts’ export server. The export server converts the chart
to an image and then sends it back to the browser.</p>

<p>The export server is a well-executed solution and should work for most situations. However for my latest project,
the charts contain sensitive data. Sending them to a third-party server is not possible. I considered setting
up my own export server, or adding an endpoint to my web application. But both these solutions add complexity
to the server for a task that theoretically can be handled in the client.</p>

<p>In this blog post, I explore various client-side solutions to downloading Highcharts as images.</p>

<h2 id="strategy">Strategy</h2>

<p>Highcharts are rendered as <a href="http://www.sitepoint.com/svg-scalable-vector-graphics-overview/">SVG (scalable vector graphics)</a>.
The basic steps to download a chart as an image are:</p>

<ul>
  <li>Get the chart’s SVG code</li>
  <li>Render the SVG onto a <code class="highlighter-rouge">&lt;cavas&gt;</code> element</li>
  <li>Use toDataURL() to extract the canvas contents as an image</li>
  <li>Save this image to the local filesystem</li>
</ul>

<h2 id="the-example-code">The Example Code</h2>

<p>Let’s start with a basic chart and download button.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'container'</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">'save_btn'</span><span class="nt">&gt;</span>Save Chart<span class="nt">&lt;/button&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nf">#container</span> <span class="p">{</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">800px</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">1em</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">save_chart</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'#container'</span><span class="p">).</span><span class="nx">highcharts</span><span class="p">({</span>

    <span class="na">exporting</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">enabled</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">},</span>

    <span class="na">title</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">text</span><span class="p">:</span> <span class="s1">'Client-Side Download Example'</span>
    <span class="p">},</span>

    <span class="na">chart</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'area'</span>
    <span class="p">},</span>

    <span class="na">xAxis</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">categories</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Jan'</span><span class="p">,</span> <span class="s1">'Feb'</span><span class="p">,</span> <span class="s1">'Mar'</span><span class="p">,</span> <span class="s1">'Apr'</span><span class="p">,</span> <span class="s1">'May'</span><span class="p">,</span> <span class="s1">'Jun'</span><span class="p">,</span>
        <span class="s1">'Jul'</span><span class="p">,</span> <span class="s1">'Aug'</span><span class="p">,</span> <span class="s1">'Sep'</span><span class="p">,</span> <span class="s1">'Oct'</span><span class="p">,</span> <span class="s1">'Nov'</span><span class="p">,</span> <span class="s1">'Dec'</span><span class="p">]</span>
    <span class="p">},</span>

    <span class="na">series</span><span class="p">:</span> <span class="p">[{</span>
      <span class="na">data</span><span class="p">:</span> <span class="p">[</span><span class="mf">29.9</span><span class="p">,</span> <span class="mf">71.5</span><span class="p">,</span> <span class="mf">106.4</span><span class="p">,</span> <span class="mf">129.2</span><span class="p">,</span> <span class="mf">144.0</span><span class="p">,</span> <span class="mf">176.0</span><span class="p">,</span> <span class="mf">135.6</span><span class="p">,</span> <span class="mf">148.5</span><span class="p">,</span> <span class="mf">216.4</span><span class="p">,</span> <span class="mf">194.1</span><span class="p">,</span> <span class="mf">95.6</span><span class="p">,</span> <span class="mf">54.4</span><span class="p">]</span>
    <span class="p">}]</span>

  <span class="p">});</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">'#save_btn'</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">save_chart</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#container'</span><span class="p">).</span><span class="nx">highcharts</span><span class="p">());</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<h2 id="1-get-the-charts-svg-code">1. Get the chart’s SVG code</h2>

<p>Highcharts has an exporting module that adds functions for downloading and printing charts. This module
must be included separately.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.highcharts.com/modules/exporting.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<p>The exporting module adds the function <a href="http://api.highcharts.com/highcharts#Chart.getSVG">getSVG</a>
which extracts the chart’s SVG code and sanitizes it for export.</p>

<p>NOTE: Because we don’t specify a hard-coded chart width in our css, we need to specify sourceWidth and
sourceHeight in the call to <code class="highlighter-rouge">getSVG</code>. This seems like a bug to me. <code class="highlighter-rouge">getSVG</code> should be able to calculate
the chart dimensions itself. (If we can get the dimensions from chart.chartWidth / chart.chartHeight,
<code class="highlighter-rouge">getSVG</code> could too)</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">getSVG</span><span class="p">({</span>
  <span class="na">exporting</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">sourceWidth</span><span class="p">:</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartWidth</span><span class="p">,</span>
    <span class="na">sourceHeight</span><span class="p">:</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartHeight</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>NOTE: Alternatively, you could grab the chart’s SVG code directly.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'#container .highcharts-container'</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span></code></pre></figure>

<p>While this eliminates the need for the exporting module, it also skips the sanitizing code. The most
obvious problem I ran into is that the resulting image may contain tooltips, which you probably don’t
want in your downloaded chart image.</p>

<h2 id="2-render-the-charts-svg-onto-a-canvas-element">2. Render the chart’s SVG onto a <code class="highlighter-rouge">&lt;canvas&gt;</code> element</h2>

<p>Rendering SVG onto a <code class="highlighter-rouge">&lt;canvas&gt;</code> element is easy. You can put SVG into the <code class="highlighter-rouge">src</code> attribute of an <code class="highlighter-rouge">&lt;img&gt;</code>
tag. The browser will render the SVG into the image. Once the image has been rendered, you render this
image onto the canvas element. You don’t even need to insert the image into the DOM for this to work.</p>

<p>To show how this works, we’ll create a preliminary version of <code class="highlighter-rouge">save_chart</code> that renders the chart’s SVG
onto a <code class="highlighter-rouge">&lt;canvas&gt;</code> element.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">EXPORT_WIDTH</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">save_chart</span><span class="p">(</span><span class="nx">chart</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">render_width</span> <span class="o">=</span> <span class="nx">EXPORT_WIDTH</span><span class="p">;</span>
  <span class="nx">render_height</span> <span class="o">=</span> <span class="nx">render_width</span> <span class="o">*</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartHeight</span> <span class="o">/</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartWidth</span>

  <span class="c1">// Get the cart's SVG code</span>
  <span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">getSVG</span><span class="p">({</span>
    <span class="na">exporting</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">sourceWidth</span><span class="p">:</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartWidth</span><span class="p">,</span>
      <span class="na">sourceHeight</span><span class="p">:</span> <span class="nx">chart</span><span class="p">.</span><span class="nx">chartHeight</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// Create a canvas</span>
  <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'canvas'</span><span class="p">);</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">render_height</span><span class="p">;</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">render_width</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>

  <span class="c1">// Create an image and draw the SVG onto the canvas</span>
  <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">;</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">'2d'</span><span class="p">).</span><span class="nx">drawImage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">render_width</span><span class="p">,</span> <span class="nx">render_height</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s1">'data:image/svg+xml;base64,'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">btoa</span><span class="p">(</span><span class="nx">svg</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>NOTE: Since we typically want to download a chart in a higher resolution than it’s displayed on the page,
we use EXPORT_WIDTH to control the size of the exported image.</p>

<p>See <a href="http://jsfiddle.net/willkoehler/1p81fbzs/">JSFiddle demo</a></p>

<h2 id="3-use-todataurl-to-extract-the-canvas-contents-as-an-image">3. Use <code class="highlighter-rouge">toDataURL</code> to extract the canvas contents as an image</h2>

<p>The canvas element has a handy function <code class="highlighter-rouge">toDataURL</code> that extracts its content as an image.
<code class="highlighter-rouge">toDataURL</code> returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/data_URIs">data URI</a> with
the image encoded in base64. This URI can then be downloaded as an image to the user’s computer.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">"image/png"</span><span class="p">)</span>
<span class="nx">download</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span> <span class="o">+</span> <span class="s1">'.png'</span><span class="p">)</span>  <span class="c1">// (still need to define this)</span></code></pre></figure>

<p>NOTE: We don’t need to to add the canvas element to the DOM in order to render and extract the
image data. So we can remove <code class="highlighter-rouge">document.body.appendChild(canvas)</code>.</p>

<h2 id="4-save-the-image-to-the-local-filesystem">4. Save the image to the local filesystem</h2>

<p>This is where things get a little hacky. There is no standard way to save data to the user’s
local filesystem. The most widely used technique is to create an <code class="highlighter-rouge">&lt;a&gt;</code> tag and then send
it a click event.</p>

<p>The <code class="highlighter-rouge">download</code> attribute of the <code class="highlighter-rouge">&lt;a&gt;</code> tag tells the browser to present the target (our chart
image) as a downloadable file with a given filename. Pretty nice, but it’s currently only
supported in Chrome and Firefox. Other browsers will just open the image in the current window
instead of presenting it as a download. Not ideal, but it’s the best we can do for now.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">download</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">;</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">data</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>And that’s everything. See this <a href="http://jsfiddle.net/willkoehler/hc6aa7yg/">JSFiddle demo</a>
for the complete code.</p>

<h2 id="not-quite-so-fast">Not quite so fast</h2>

<p>So everything looks good… except it doesn’t work in IE. The first problem is that IE throws a
“SecurityError” on the call to <code class="highlighter-rouge">toDataURL</code>. This is because IE considers the canvas to be
“tainted” once an SVG image has been rendered. SVG code can reference content from the user’s
local file system. Once that’s in the canvas element it would be security vulnerability
to allow the canvas contents to be extracted. Otherwise a malicious site could read data from
the user’s file system and send it on to an external server.</p>

<p><a href="https://connect.microsoft.com/IE/feedback/details/809823/draw-svg-image-on-canvas-context">This forum message</a>
is the only reference I can find discussing the issue in IE. Either Chrome, Firefox, and Safari have
ways of sanitizing SVG content before rendering onto a canvas, or they don’t allow SVG code to
reference local content, or they are not concerned about this vulnerability.</p>

<h2 id="ie-work-around-1-use-canvg">IE work-around #1: use canvg</h2>

<p>We can work-around the canvas tainting issue with the <a href="https://github.com/gabelerner/canvg">canvg library</a>.
canvg is a full SVG parser and renderer. It can render SVG onto a canvas element with all of the features
of the browser’s built-in SVG render. It’s an impressive piece of code, and works flawlessly. But it’s
also 2800 lines of javascript that are entirely unnecessary in any modern browser, because the browser
itself can render SVG onto a canvas element. However, because canvg parses the SVG code by hand, manually
rendering each path, box, quadratic curve, gradient, pattern etc. it sidesteps the IE “SecurityError”.</p>

<p>Replace the <code class="highlighter-rouge">var image = new Image...</code> code with this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">canvg</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">svg</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">scaleWidth</span><span class="p">:</span> <span class="nx">render_width</span><span class="p">,</span>
  <span class="na">scaleHeight</span><span class="p">:</span> <span class="nx">render_height</span><span class="p">,</span>
  <span class="na">ignoreDimensions</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">"image/png"</span><span class="p">)</span>
<span class="nx">download</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">filename</span> <span class="o">+</span> <span class="s1">'.png'</span><span class="p">);</span></code></pre></figure>

<h2 id="still-not-working-url-limit">Still not working… URL limit</h2>

<p>With the “SecurityError” fix in place, we hit the next barrier. IE stops with the error
“The data area passed to a system call is too small” on the call to <code class="highlighter-rouge">a.click()</code>. I <em>think</em>
this is because IE has a <a href="http://support.microsoft.com/kb/208427">2083 character URL limit</a>.
The data URIs generated by <code class="highlighter-rouge">toDataURL</code> are much longer than 2083 characters.</p>

<h2 id="ie-work-around-2-use-mssaveoropenblob">IE work-around #2: use <code class="highlighter-rouge">msSaveOrOpenBlob</code></h2>

<p>I’m calling this a work-around. But it’s actually an improvement over the <code class="highlighter-rouge">&lt;a&gt;</code> tag hack.
IE has a function <a href="http://msdn.microsoft.com/en-us/library/ie/hh779016(v=vs.85).aspx">msSaveOrOpenBlob</a>
that presents client-side data to the user as if it were downloaded from the internet. It’s
exactly what we need. Let’s add logic to use <code class="highlighter-rouge">msSaveOrOpenBlob</code> in IE and use the <code class="highlighter-rouge">&lt;a&gt;</code> tag hack everywhere else.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">download</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">download_in_ie</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="o">||</span> <span class="nx">download_with_link</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Works in IE10 and newer</span>
<span class="kd">function</span> <span class="nx">download_in_ie</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">msSaveOrOpenBlob</span> <span class="o">&amp;&amp;</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">msSaveOrOpenBlob</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">msToBlob</span><span class="p">(),</span> <span class="nx">filename</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">// Works in Chrome and FF. Safari just opens image in current window, since</span>
<span class="c1">// .download attribute is not supported</span>
<span class="kd">function</span> <span class="nx">download_with_link</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="nx">filename</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">"image/png"</span><span class="p">)</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
  <span class="nx">a</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>Here’s the <a href="http://jsfiddle.net/willkoehler/vushe780/">JSFiddle demo</a> putting it all together.</p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>It took a while to get here, but the final solution isn’t bad. My main reservation is pulling in
canvg. But it’s a stable library and seems like a necessary tradeoff for IE support.</p>

<p>A few other libraries that I tested along the way:</p>

<p><a href="https://github.com/eligrey/FileSaver.js/">FileSaver.js</a> - If you want a fully-supported,
cross-browser “just save it” solution, this is a good library. At its core, FileSaver.js uses
the same <code class="highlighter-rouge">&lt;a&gt;</code> tag hack I used above. But FileSaver.js has a lot of additional complexity
to handle edge cases that I didn’t feel was needed for this situation. I ultimately decided
not to use it. But it’s a solid library and Eli Grey has put a lot of work into making it work
flawlessly. Definitely work a look.</p>

<p><a href="https://github.com/eligrey/canvas-toBlob.js">canvas-toBlob.js</a> - If you use FileSaver.js, you will
need this library to pull the blob data out of the canvas element. It implements the standard
<a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement.toBlob">canvas.toBlob()</a>
function for browsers that don’t support it yet. It’s another solid piece of code by Eli Grey.</p>

      
<div class="social">
  
  <div class='twitter'>
    <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Client-Side Solution For Downloading Highcharts Charts as Images" data-related="wckoehler">Tweet</a>
  </div>
  

  
  <div class='facebook'>
    <div class="fb-share-button" data-layout="button_count"></div>
  </div>
  

  

  
  <div class='reddit'>
    <a href="//www.reddit.com/submit" onclick="window.open('//www.reddit.com/submit?url=http://willkoehler.net/2014/11/07/client-side-solution-for-downloading-highcharts-charts-as-images.html&title=Client-Side+Solution+For+Downloading+Highcharts+Charts+as+Images'); return false"> <img src="//www.redditstatic.com/spreddit7.gif" alt="submit to reddit" border="0" /> </a>
  </div>
  
</div>


    </section>

    <footer>
      <address>
        <img src="/images/wk.jpg">
        <p>Written by <strong><a rel="author" href="https://twitter.com/wckoehler" title="" target="_blank">Will Koehler</a></strong><br>
          <span class="muted">Web developer specializing in full-stack Rails applications.</span>
        </p>
      </address>
      
      
      <section class="post_summary">
        <h3 class="title">Next up: <a href="/2014/12/22/alternate-route-options-for-the-olentangy-trail.html" rel="prefetch">Alternate Route Options For The Olentangy Trail</a></h3>
        <p>Recommendations to create a safe alternate route for trail traffic while the Olentangy Trail is closed under the 315/270 interchange.</p>
        <hr>
      </section>
      
      
      
      <section class="post_summary">
        <h3 class="title">Previous story: <a href="/2014/10/15/deploy-a-rails-app-with-aws-opsworks.html" rel="prefetch">Deploy a Rails App with AWS OpsWorks</a></h3>
        <p>AWS OpsWorks hits a sweet spot, providing a turnkey deployment solution, almost as simple as Heroku, while allowing unlimited customization to your production stack with the power and flexibility of Chef.</p>
        <hr>
      </section>
      
      
      <section>
        <div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'koehlerblog';

  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

      </section>
      
    </footer>
  </div>
</article>


  <footer class="site-footer">
    <div class="container">
      &copy; 2019 Will Koehler

      <nav>
        <a href="/">Blog</a> &middot;
        <a href="/about.html">About</a>
      </nav>

      <nav class="social">
        
<a href="https://twitter.com/wckoehler" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter"></i></a>


<a href="https://github.com/willkoehler" title="Watch on Github" target="_blank"><i class="icon icon-github"></i></a>


<a href="/atom.xml" title="RSS Feed">
  <i class="icon icon-rss"></i>
</a>

      </nav>
      <div>Based on Incorporated theme by <a href="https://sendtoinc.com">Inc</a></div>
    </div>
  </footer>

</body>
</html>
